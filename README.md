Resilience4j

Circuit breaker—Stops making requests when an invoked service is failing
Retry—Retries a service when it temporarily fails
Bulkhead—Limits the number of outgoing concurrent service requests to avoid overload
Rate limit—Limits the number of calls that a service receives at a time
Fallback—Sets alternative paths for failing requests

автоматический выключатель размыкается только тогда, когда интенсивность отказов превышает настраиваемый порог.
Когда автоматический выключатель находится в разомкнутом состоянии, все вызовы отклоняются в течение настраиваемого времени, и автоматический выключатель срабатывает.
По истечении времени настройки автоматический выключатель переходит в полуоткрытое состояние и по ряду запросов позволяет узнать, недоступна ли услуга.

В полуоткрытом состоянии автоматический выключатель использует другой конфигурируемый буфер кольцевых битов для оценки частоты отказов. Если эта новая частота отказов превышает настроенный порог, автоматический выключатель снова отключается; если он ниже или равен порогу, он снова становится закрытым. Это может сбивать с толку, но помните, что в разомкнутом состоянии автоматический выключатель отклоняет, а в замкнутом состоянии автоматический выключатель принимает все запросы.

DISABLED—Always allow access
FORCED_OPEN—Always deny access


Резервные варианты обеспечивают порядок действий, когда ресурс истек или вышел из строя. Если вы обнаружите, что используете резервные варианты для перехвата исключения тайм-аута, а затем не делаете ничего, кроме регистрации ошибки, вам следует вместо этого использовать стандартный блок try ... catch вокруг вызова службы: перехватить исключение и поместить логику ведения журнала в try. .. поймать блок.
Помните о действиях, которые вы предпринимаете с помощью резервных функций. Если вы обращаетесь к другой распределенной службе в резервной службе, вам может потребоваться обернуть резервную копию@CircuitBreaker. Помните, что тот же сбой, с которым вы столкнулись с вашим основным курсом действий, также может повлиять на ваш дополнительный запасной вариант. Используйте защитный код.

ciclybarrier@mail.ru


(requests per second at peak when the service is healthy * 99th percentile latency in seconds) + small amount of extra threads for overhead
maxWaitDuration—Устанавливает максимальное время для блокировки потока при входе в переборку. Значение по умолчанию - 0.
maxConcurrentCalls- Устанавливает максимальное количество одновременных вызовов, разрешенное переборкой. Значение по умолчанию - 25.
maxThreadPoolSize—Устанавливает максимальный размер пула потоков. Значение по умолчанию - Runtime.getRuntime().availableProcessors().
coreThreadPoolSize—Устанавливает размер пула основных потоков. Значение по умолчанию - Runtime.getRuntime().availableProcessors().
queueCapacity- Устанавливает емкость очереди. Значение по умолчанию - 100.
KeepAliveDuration- Устанавливает максимальное время, в течение которого незанятые потоки будут ждать новых задач перед завершением. Это происходит, когда количество потоков превышает количество основных потоков. Значение по умолчанию - 20 мс.

Первый параметр, maxRetryAttempts, позволяет нам определить максимальное количество повторных попыток для нашей службы. Значение по умолчанию для этого параметра - 3. Второй параметр,waitDuration, позволяет нам определить продолжительность ожидания между попытками повтора. Значение по умолчанию для этого параметра - 500 мс. Третий параметр,retry-exceptions, задает список классов ошибок, которые будут повторяться. Значение по умолчанию пусто. В этой книге мы используем только эти три параметра, но вы также можете установить следующие:

intervalFunction- устанавливает функцию для обновления интервала ожидания после сбоя.
retryOnResultPredicate- настраивает предикат, который оценивает, следует ли повторить попытку результата. Этот предикат должен вернуться, trueесли мы хотим повторить попытку.
retryOnExceptionPredicate- настраивает предикат, который оценивает, следует ли повторить исключение. То же, что и предыдущий предикат; мы должны вернуться, trueесли хотим повторить попытку.
ignoreExceptions- Устанавливает список классов ошибок, которые игнорируются и не будут повторяться. Значение по умолчанию пусто.